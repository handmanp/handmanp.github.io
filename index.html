<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
	<title>original</title>
	<script type="text/javascript" src="http://handmanp.ddns.net:7001/socket.io/socket.io.js/"></script>
	<script type="text/javascript" src="/script/rtc.js"></script>
	<script type="text/javascript" src="/script/connection.js"></script>
	<script type="text/javascript" src="/script/jsSHA/sha.js"></script>
</head>

<style type="text/css">
	.thumb {
		height: 75px;
		border: 1px solid #000;
		margin: 10px 5px 0 0;
	}
</style>

<body>
<strong>socket.io Signaling for Multi-party</strong><br><br>
<a href="http://localhost:8000/socket.html">TOP</a><br>
<ul id="peerList">
</ul><br>


<button onclick="connect();" id="btnConnect">接続</button><br/>
<button onclick="hangUp();" id="btnHangup">切断</button><br/>


<a href="https://w3c.github.io/webrtc-pc/#peer-to-peer-data-example">参考</a><br>



<input type="text" placeholder="roomname" name="roomname" id="roomname">
<button id="createRoom">作成</button><br>


<input type="file" id="files" name="files[]" multiple />
<output id="list"></output>

<button id="sendMessage">送信</button><br><br>

<output id="authImages"></output>

<script type="text/javascript">
	function handleFileSelect(evt) {
		var files = evt.target.files; // FileList object

		// Loop through the FileList and render image files as thumbnails.
		for (var i = 0, f; f = files[i]; i++) {

			// Only process image files.
			if (!f.type.match('image.*')) {
				continue;
			}

			var reader = new FileReader();

			// Closure to capture the file information.
			reader.onload = (function(theFile) {
				return function(e) {
					// Render thumbnail.
					var span = document.createElement('span');
					span.innerHTML = ['<img class="thumb" src="', e.target.result,
					                  '" title="', escape(theFile.name), '"/>'].join('');
					document.getElementById('list').insertBefore(span, null);
				};
			})(f);

			// Read in the image file as a data URL.
			reader.readAsDataURL(f);
		}
	}

	function refreshList(message) {
		var pl = document.getElementById('peerList');
		var list = document.getElementById('list');
		var count = 0;
		ids = message.room;
		console.log('Event id:', ids);
		pl.textContent = null;
		for (id in message.room) {
			if (message.room[id] === 'lobby') continue;
			var li = document.createElement('li');
			li.innerHTML = "<a href='javascript:void(0)' onclick='auth(\"" + message.room[id] + "\")'>" + message.room[id] + "</a>";
			li.setAttribute('id', 'list');
			pl.appendChild(li);
		}
	}

	document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>


<script type="text/javascript">
	/*
	const configuration = {iceServers: [{urls: 'stun:stun.l.google.com:19302'}]};
	var signaling = new WebSocket('ws://localhost:7001');
	let pc;			// RTCPeerConnection
	let channel;
	*/



	window.onload = () => {
		document.getElementById('sendMessage').addEventListener("click", () => {
			var files = document.getElementById('files');
			if (!files.value) {
				console.log('No file selected');
			}
			else {
				for (var i = 0; i < files.files.length; i++) {
					var img = files.files[i];
					console.log('PC:', peerConnections);
					for (let id in peerConnections) {
						console.log('id', id);
						dataChannelSend(id, img);
					}
				}
			}
		});

		document.getElementById('createRoom').addEventListener("click", () => {
			var roomname = document.getElementById('roomname').value;
			createRoom(roomname);
		});
	}
</script> 

</body>
</html>
